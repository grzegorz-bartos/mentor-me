{% extends "base.html" %}
{% load crispy_forms_tags static calendar_tags %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/booking.css' %}">
{% endblock %}
{% block content %}
    <main class="main">
        <div class="page-title" data-aos="fade">
            <div class="heading">
                <div class="container">
                    <div class="row d-flex justify-content-center text-center">
                        <div class="col-lg-8">
                            <h1>Book a Session</h1>
                            <p class="mb-0">
                                {{ listing.title }} - ${{ listing.price }}
                                {% if listing.rate_unit == "hourly" %}/hour{% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <section class="section">
            <div class="container" data-aos="fade-up">
                <div class="row">
                    <!-- Left: Calendar -->
                    <div class="col-lg-6 mb-4">
                        <div class="sticky-top" style="top: 100px;">
                            <h5 class="mb-3">Select a Date</h5>
                            {% render_calendar year=current_year month=current_month tutor_availabilities=availabilities availability_counts=availability_counts %}
                            <div class="mt-3 small text-muted">
                                <div class="d-flex flex-column gap-1">
                                    <div>
                                        <span class="badge" style="background-color: #d4edda; color: #155724;">Green</span> Good availability (4+ slots)
                                    </div>
                                    <div>
                                        <span class="badge" style="background-color: #fff3cd; color: #856404;">Yellow</span> Low availability (1-3 slots)
                                    </div>
                                    <div>
                                        <span class="badge" style="background-color: #f8d7da; color: #721c24;">Red</span> Fully booked
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Right: Booking Form -->
                    <div class="col-lg-6">
                        <div class="booking-panel">
                            <h5>Book a Session</h5>
                            <div class="alert alert-info mb-3">
                                <strong>Session Length:</strong> 1 hour
                                <br>
                                <strong>Available Hours:</strong> 6:00 AM - 11:00 PM
                                <br>
                                <strong>Rate:</strong> ${{ listing.price }}
                                {% if listing.rate_unit == "hourly" %}/hour{% endif %}
                            </div>
                            <form method="post" id="booking-form">
                                {% csrf_token %}
                                <input type="hidden" id="listing-id" value="{{ listing.id }}">
                                <input type="hidden" name="date" id="selected-date">
                                <input type="hidden" name="start_time" id="selected-time">
                                <div class="mb-3">
                                    <label class="form-label" id="time-label">Select a date first</label>
                                    <div id="time-slots-container" class="time-slots-grid"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="id_notes" class="form-label">Notes (optional)</label>
                                    <textarea name="notes" id="id_notes" class="form-control" rows="3"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary" id="submit-booking" disabled>Book Session</button>
                                <a href="{% url 'listing-detail' listing.id %}"
                                   class="btn btn-secondary">Cancel</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
{% endblock %}
{% block extra_js %}
    <script src="{% static 'js/booking.js' %}"></script>
{% endblock %}
